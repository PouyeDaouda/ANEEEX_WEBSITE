document.addEventListener("DOMContentLoaded",(function(){const addArticleBtn=document.getElementById("addArticleBtn");const modal=document.getElementById("articleModal");const closeModalBtn=document.querySelector(".close-modal");const articleForm=document.getElementById("articleForm");const csrfToken=document.querySelector('input[name="_csrf"]')?.value;const modalTitle=document.getElementById("modalTitle");const articleIdInput=document.getElementById("articleId");const titleModalInput=document.getElementById("titleModalInput");const descriptionModalInput=document.getElementById("descriptionModalInput");const mediaFileInputGroupModal=document.getElementById("mediaFileInputGroupModal");const mediaFileModalInput=document.getElementById("mediaFileModal");const deleteButtons=document.querySelectorAll(".delete-btn");function toggleMediaInputFieldsModal(){const isEditing=!!articleIdInput.value;const selectedType=document.querySelector('input[name="mediaType"]:checked')?.value;if(selectedType==="image"){mediaFileInputGroupModal.style.display="block";mediaFileModalInput.required=!isEditing;if(isEditing){mediaFileModalInput.value=""}}}if(addArticleBtn){addArticleBtn.addEventListener("click",(function(e){e.preventDefault();modalTitle.textContent="Nouvel article";articleForm.reset();articleIdInput.value="";mediaFileInputGroupModal.style.display="block";mediaFileModalInput.required=true;modal.style.display="flex"}))}if(closeModalBtn){closeModalBtn.addEventListener("click",(function(){modal.style.display="none"}))}window.addEventListener("click",(function(e){if(e.target===modal){modal.style.display="none"}}));if(articleForm){articleForm.addEventListener("submit",(function(e){e.preventDefault();const formData=new FormData;const articleId=articleIdInput.value;let method=articleId?"PUT":"POST";let url=articleId?`/admin/articles/${articleId}`:"/admin/articles";formData.append("title",titleModalInput.value.trim());formData.append("description",descriptionModalInput.value.trim());formData.append("mediaType","image");formData.append("_csrf",csrfToken);if(mediaFileModalInput.files.length>0){formData.append("mediaFile",mediaFileModalInput.files[0])}else if(!articleId){alert("Veuillez sélectionner un fichier image.");return}const submitButton=articleForm.querySelector('button[type="submit"]');if(!submitButton){console.error("Bouton de soumission non trouvé");return}const originalButtonText=submitButton.textContent;submitButton.textContent="Enregistrement...";submitButton.disabled=true;fetch(url,{method:method,body:formData}).then((response=>{if(response.ok){return response.json()}return response.text().then((text=>{try{const errBody=JSON.parse(text);throw new Error(errBody.message||text||`Erreur HTTP ${response.status}`)}catch(e){throw new Error(text||`Erreur HTTP ${response.status}`)}}))})).then((data=>{window.location.reload()})).catch((error=>{console.error("Erreur lors de la soumission du formulaire:",error);alert(error.message||"Une erreur est survenue lors de l'enregistrement.")})).finally((()=>{submitButton.textContent=originalButtonText;submitButton.disabled=false}))}))}deleteButtons.forEach((button=>{button.addEventListener("click",(function(e){e.preventDefault();const articleId=this.getAttribute("data-id");if(confirm("Êtes-vous sûr de vouloir supprimer cet article ?")){fetch(`/admin/articles/${articleId}/delete`,{method:"POST",headers:{"X-CSRF-Token":csrfToken}}).then((response=>{if(response.ok){return response.json()}return response.text().then((text=>{try{const errBody=JSON.parse(text);throw new Error(errBody.message||text||`Erreur HTTP ${response.status}`)}catch(e){throw new Error(text||"Erreur de suppression inconnue")}}))})).then((data=>{window.location.reload()})).catch((error=>{console.error("Erreur lors de la suppression:",error);alert(error.message||"Une erreur est survenue lors de la suppression.")}))}}))}))}));